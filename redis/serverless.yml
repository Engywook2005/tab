service: tab-redis

provider:
  name: aws
  region: us-west-2
  stage: ${env:SLS_STAGE, self:custom.stageDefault}

custom:
  stageDefault: dev

# Based on:
# https://github.com/mugglmenzel/serverless-examples-cached-rds-ws/blob/master/serverless.yml

resources:
  Resources:
    LambdaForRedisSecurityGroup:
      Type: AWS::EC2::SecurityGroup
      Properties:
        GroupName: Tab Lambda accessing Redis
        GroupDescription: For Lambda function that accesses Tab Redis ElastiCache
        Tags:
          - Key: Name
            Value: Tab Lambda for Redis
    RedisClusterSecurityGroup:
      Type: AWS::EC2::SecurityGroup
      Properties:
        GroupName: Tab Redis cluster
        GroupDescription: Ingress for Tab Redis ElastiCache Cluster
        SecurityGroupIngress:
          - IpProtocol: tcp
            FromPort: 6379
            ToPort: 6379
            SourceSecurityGroupId:
              "Fn::GetAtt": LambdaForRedisSecurityGroup.GroupId
        Tags:
          - Key: Name
            Value: Tab Redis cluster
